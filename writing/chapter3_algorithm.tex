\chapter{Sampling algorithm design and implementation}

The input of the sampling algorithm is a HMM and a sequence of events read from MinION.
We would like to generate samples of DNA sequences that correspond to the provided event sequence
and the probabilty of generating said sample should be the same as the probability of the path
through the HMM which generated the sequence of events.

The first step of the algorithm is to precompute a matrix using forward algorithm

\section{Forward Algorithm}

Suppose we want to obtain a probability of generating an emission sequence $x$. In order to do that, we
have to sum up the probabilities of all the paths $\pi$ that lead to generating the $x$.
$$P(x) = \sum_{\pi}{P(x | \pi)}$$
It is possible to calculate $P(x)$ using dynamic programming algorithm which computes a matrix with values
$f_k(i) = P(x_1 \dots x_i | \pi_i = k)$ expressing the probability that for a generated emission sequence $x_1 \dots x_i$
the HMM ended up in state $k$.
The matrix of values $f_k(i)$ for HMM $H = (Q,S,E,q_0,e,t)$ and emission sequence $x$ can be computed recursively by formula

$$f_l(0) = 1 if l = q_0$$
$$f_l(0) = 0 if l \neq q_0$$
$$f_l(i+1) = e_l(x_{i+1}) \sum_{k}{f_k(i)a_{kl}} if l \in Q \setminus S$$
$$f_l(i+1) = \sum_{k}{f_k(i)a_{kl}} if u \in S$$

where $e_l(x_{i+1})$ is the emission probability of $x_{i+1}$ for state $l$ and $a_{kl}$ is the transition probability from
state $k$ to state $l$

\section{Sampling}

We now use the matrix calculated by forward algorithm to generate samples (in our case the paths).

